# 条件概率与链式法则（Conditional Probability & Chain Rule）

## 1. 一句话
- 条件概率描述在已知某事件发生的前提下，另一事件发生的概率；链式法则（乘法法则）是分解联合概率的核心工具

---

## 2. 定义

### 条件概率
给定 $P(B) > 0$，事件 $A$ 在 $B$ 发生条件下的概率：

$$P(A|B) = \frac{P(A, B)}{P(B)}$$

其中 $P(A, B) = P(A \cap B)$ 为联合概率。

### 链式法则（乘法法则）
由条件概率定义直接得到：

$$P(A, B) = P(A|B) \cdot P(B) = P(B|A) \cdot P(A)$$

**多变量推广**：
$$P(X_1, X_2, \ldots, X_n) = P(X_1) \cdot P(X_2|X_1) \cdot P(X_3|X_1,X_2) \cdots P(X_n|X_1,\ldots,X_{n-1})$$

---

## 3. 常用形式

### 带条件的链式法则
给定条件 $C$，对 $X$ 和 $Z$ 的联合分布：

$$P(X, Z | C) = P(X | Z, C) \cdot P(Z | C)$$

**应用实例**（轨迹预测/序列模型）：
$$P(X_{t+1}, Z | C) = P(X_{t+1} | Z, C) \cdot P(Z | C)$$

其中：
- $C$：条件/上下文（如历史轨迹）
- $Z$：潜变量
- $X_{t+1}$：下一时刻状态

### Bayes 公式
链式法则的直接推论：

$$P(A|B) = \frac{P(B|A) \cdot P(A)}{P(B)}$$

---

## 4. 直觉

- **链式法则本质**：把联合概率"拆"成条件概率的乘积
- **拆分顺序任意**：$P(A,B) = P(A|B)P(B) = P(B|A)P(A)$，选择哪种取决于哪个条件概率更容易计算/建模
- **生成模型视角**：先采样 $Z \sim P(Z|C)$，再采样 $X \sim P(X|Z,C)$，等价于从 $P(X,Z|C)$ 采样

---

## 5. 在哪些地方出现

- **VAE/CVAE**：$P(X,Z|C) = P(X|Z,C)P(Z|C)$，decoder × prior
- **HMM**：$P(X_{1:T}, Z_{1:T}) = \prod_t P(X_t|Z_t)P(Z_t|Z_{t-1})$
- **轨迹预测**：$P(X_{t+1}, Z | C) = P(X_{t+1}|Z,C) \cdot P(Z|C)$
- **Bayes 推断**：后验 ∝ 似然 × 先验

---

## 6. 速查

| 公式 | 含义 |
|------|------|
| $P(A\|B) = \frac{P(A,B)}{P(B)}$ | 条件概率定义 |
| $P(A,B) = P(A\|B)P(B)$ | 乘法法则（链式法则） |
| $P(X,Z\|C) = P(X\|Z,C)P(Z\|C)$ | 带条件的链式法则 |
| $P(A\|B) = \frac{P(B\|A)P(A)}{P(B)}$ | Bayes 公式 |

---

## 7. 常见误区
- 混淆 $P(A,B)$ 和 $P(A|B)$：前者是联合，后者是条件
- 忘记条件概率要求 $P(B) > 0$
- 链式法则拆分顺序写反（顺序任意但要一致）

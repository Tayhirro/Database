(X, 可选I) -> (可选 SemanticMap CNN 得到 v 并拼到轨迹token) -> Time Encoder -> AgentFormer Encoder -> 得到历史特征 C -> [Prior: C -> (mu_p, sigma_p)] + [Train时 Posterior: (Y, C) -> AgentFormer Decoder -> pooling -> (mu_q, sigma_q)] -> 采样 Z(训练用q/测试用p或sampler) -> 自回归生成: 用(已生成的 y_0..y_t 与 Z 拼接)做query、用C做key/value过AgentFormer Decoder -> 输出 y_{t+1} -> 重复T步得到未来轨迹 Y_hat(可采样K条)